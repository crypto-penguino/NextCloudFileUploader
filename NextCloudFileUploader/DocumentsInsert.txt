BEGIN
	IF NOT EXISTS(SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[IncrBy1]') AND type = 'SO')
		CREATE SEQUENCE IncrBy1  
			START WITH 0  
			INCREMENT BY 1
			MINVALUE 0
			MAXVALUE 9223372036854775807
			CACHE  3 
	ELSE
		ALTER SEQUENCE IncrBy1
			RESTART WITH 0  
				INCREMENT BY 1
				MINVALUE 0
				MAXVALUE 9223372036854775807
				CACHE  3 
END

BEGIN
	BEGIN
		INSERT INTO [dbo].[DODocuments] (Number, Entity, EntityId, FileId, Version)
		SELECT NEXT VALUE FOR IncrBy1 OVER(ORDER BY af.CreatedOn), 'AccountFile' as Entity, af.AccountId, af.Id, af.Version from [dbo].[AccountFile] af WITH (NOLOCK)
		WHERE af.AccountId is not null and af.Id is not null
		ORDER BY af.AccountId, af.Id
	END
	BEGIN
		INSERT INTO [dbo].[DODocuments] (Number, Entity, EntityId, FileId, Version)
		SELECT NEXT VALUE FOR IncrBy1 OVER(ORDER BY cf.CreatedOn), 'ContactFile' as Entity, cf.ContactId, cf.Id, cf.Version from [dbo].[ContactFile] cf WITH (NOLOCK)
		WHERE cf.ContactId is not null and cf.Id is not null
		ORDER BY cf.ContactId, cf.Id
	END
	BEGIN
		INSERT INTO [dbo].[DODocuments] (Number, Entity, EntityId, FileId, Version)
		SELECT NEXT VALUE FOR IncrBy1 OVER(ORDER BY f.CreatedOn), 'ContractFile' as Entity, f.ContractId, f.Id, fv.PTVersion from [dbo].[ContractFile] f WITH (NOLOCK)
		INNER JOIN [dbo].[PTFileVersion] fv ON f.ContractId IS NOT NULL AND f.Id IS NOT NULL AND fv.PTVersion IS NOT NULL AND fv.PTFile = f.Id 
		ORDER BY f.ContractId, f.Id
	END
END;